// ═══════════════════════════════════════════════════════════
// FLUXOGRAMAS CLÍNICOS EXPANDIDOS — 14+ Protocolos Adicionais
// ═══════════════════════════════════════════════════════════

export interface ExpandedFlowchart {
  id: string; name: string; specialty: string; urgency: 'emergencia' | 'urgencia' | 'ambulatorial';
  description: string; reference: string;
  nodes: { id: string; type: 'start' | 'decision' | 'action' | 'end' | 'alert'; text: string; detail?: string }[];
  edges: { from: string; to: string; label?: string }[];
}

export const EXPANDED_FLOWCHARTS: ExpandedFlowchart[] = [
  {
    id: 'iam_sst', name: 'IAM com Supra de ST', specialty: 'Cardiologia', urgency: 'emergencia',
    description: 'Manejo do infarto agudo do miocárdio com supradesnivelamento de ST — tempo é músculo',
    reference: 'SBC 2024 / ESC 2023',
    nodes: [
      { id: 'start', type: 'start', text: 'Dor torácica sugestiva de SCA' },
      { id: 'ecg', type: 'action', text: 'ECG em até 10 minutos', detail: 'Monitorização, acesso venoso, O2 se SpO2 < 90%' },
      { id: 'sst', type: 'decision', text: 'Supra de ST ≥ 1mm em 2 derivações contíguas?' },
      { id: 'mona', type: 'action', text: 'Terapia inicial: AAS 300mg + Clopidogrel 300-600mg + Heparina + Morfina se dor refratária', detail: 'NÃO atrasar reperfusão para exames' },
      { id: 'tempo', type: 'decision', text: 'ICP disponível em < 120 min (porta-balão)?' },
      { id: 'icp', type: 'action', text: 'ICP PRIMÁRIA (Angioplastia)', detail: 'Meta: porta-balão < 90 min. Transferir se necessário.' },
      { id: 'fibrinolitico', type: 'action', text: 'FIBRINOLÍTICO em < 30 min (porta-agulha)', detail: 'Tenecteplase (TNK) dose por peso. Contraindicações absolutas: AVC hemorrágico, sangramento ativo, dissecção aórtica.' },
      { id: 'reperfusao', type: 'decision', text: 'Critérios de reperfusão em 60-90 min?' },
      { id: 'sucesso', type: 'end', text: 'Reperfusão bem-sucedida → UTI coronariana → Terapia adjuvante (IECA, estatina, betabloqueador)' },
      { id: 'resgate', type: 'action', text: 'ICP de RESGATE', detail: 'Se fibrinólise falhou: transferir para ICP imediatamente' },
      { id: 'sem_sst', type: 'action', text: 'Protocolo IAMSSST/Angina Instável', detail: 'Estratificação de risco (GRACE/TIMI). Troponina seriada.' },
    ],
    edges: [
      { from: 'start', to: 'ecg' }, { from: 'ecg', to: 'sst' },
      { from: 'sst', to: 'mona', label: 'SIM' }, { from: 'sst', to: 'sem_sst', label: 'NÃO' },
      { from: 'mona', to: 'tempo' }, { from: 'tempo', to: 'icp', label: 'SIM — ICP < 120 min' },
      { from: 'tempo', to: 'fibrinolitico', label: 'NÃO — ICP indisponível' },
      { from: 'fibrinolitico', to: 'reperfusao' }, { from: 'reperfusao', to: 'sucesso', label: 'SIM — Resolução ST > 50%' },
      { from: 'reperfusao', to: 'resgate', label: 'NÃO — Falha' }, { from: 'icp', to: 'sucesso' }, { from: 'resgate', to: 'sucesso' },
    ],
  },
  {
    id: 'avc_agudo', name: 'AVC Agudo — Protocolo de Trombólise', specialty: 'Neurologia', urgency: 'emergencia',
    description: 'Manejo do AVC isquêmico agudo com janela para trombólise — tempo é cérebro',
    reference: 'AHA/ASA 2024 / ABN 2023',
    nodes: [
      { id: 'start', type: 'start', text: 'Déficit neurológico agudo (suspeita de AVC)' },
      { id: 'nihss', type: 'action', text: 'NIHSS + Glicemia capilar + Sinais vitais', detail: 'Ativar protocolo de AVC. Tempo é cérebro!' },
      { id: 'tc', type: 'action', text: 'TC de crânio SEM contraste em < 25 min', detail: 'Excluir hemorragia. Sinais precoces de isquemia.' },
      { id: 'hemorragia', type: 'decision', text: 'Hemorragia na TC?' },
      { id: 'avc_h', type: 'end', text: 'AVC HEMORRÁGICO → Neurocirurgia + Reverter anticoagulação + PA < 140 mmHg' },
      { id: 'janela', type: 'decision', text: 'Início dos sintomas < 4,5 horas?' },
      { id: 'criterios', type: 'decision', text: 'Critérios para trombólise? (sem contraindicações)' },
      { id: 'alteplase', type: 'action', text: 'ALTEPLASE 0,9 mg/kg IV (máx 90 mg)', detail: '10% em bolus 1 min + 90% em 60 min. PA < 185/110 antes. Monitorar NIHSS a cada 15 min.' },
      { id: 'trombectomia', type: 'decision', text: 'Oclusão de grande vaso (angio-TC)? NIHSS ≥ 6?' },
      { id: 'tev', type: 'action', text: 'TROMBECTOMIA MECÂNICA em < 24h', detail: 'Janela estendida com mismatch (DAWN/DEFUSE-3). Transferir para centro com neurointervenção.' },
      { id: 'suporte', type: 'end', text: 'Cuidados de suporte: UTI AVC, PA permissiva (< 220/120), glicemia 140-180, normotermia, profilaxia TEV' },
    ],
    edges: [
      { from: 'start', to: 'nihss' }, { from: 'nihss', to: 'tc' }, { from: 'tc', to: 'hemorragia' },
      { from: 'hemorragia', to: 'avc_h', label: 'SIM' }, { from: 'hemorragia', to: 'janela', label: 'NÃO (isquêmico)' },
      { from: 'janela', to: 'criterios', label: 'SIM' }, { from: 'janela', to: 'trombectomia', label: 'NÃO (> 4,5h)' },
      { from: 'criterios', to: 'alteplase', label: 'SIM' }, { from: 'criterios', to: 'trombectomia', label: 'NÃO (contraindicação)' },
      { from: 'alteplase', to: 'trombectomia' }, { from: 'trombectomia', to: 'tev', label: 'SIM' },
      { from: 'trombectomia', to: 'suporte', label: 'NÃO' }, { from: 'tev', to: 'suporte' },
    ],
  },
  {
    id: 'insuf_respiratoria', name: 'Insuficiência Respiratória Aguda', specialty: 'Pneumologia/UTI', urgency: 'emergencia',
    description: 'Abordagem sistemática da insuficiência respiratória aguda com escalonamento de suporte',
    reference: 'SBPT 2024 / ARDS Network',
    nodes: [
      { id: 'start', type: 'start', text: 'Dispneia aguda + SpO2 < 92% ou FR > 30' },
      { id: 'avaliacao', type: 'action', text: 'ABC + Gasometria arterial + Rx tórax', detail: 'Tipo I (hipoxêmica: PaO2 < 60) ou Tipo II (hipercápnica: PaCO2 > 50)' },
      { id: 'tipo', type: 'decision', text: 'Tipo de insuficiência respiratória?' },
      { id: 'o2', type: 'action', text: 'O2 suplementar: cateter nasal 1-6 L/min ou máscara com reservatório 10-15 L/min', detail: 'Meta SpO2 92-96% (88-92% se DPOC)' },
      { id: 'resposta_o2', type: 'decision', text: 'Resposta ao O2? SpO2 > 92% e FR < 30?' },
      { id: 'cnaf', type: 'action', text: 'Cateter Nasal de Alto Fluxo (CNAF) 40-60 L/min', detail: 'FiO2 titulada. Índice ROX > 4,88 em 12h = bom prognóstico.' },
      { id: 'vni', type: 'action', text: 'VNI (CPAP/BiPAP)', detail: 'CPAP 5-10 cmH2O ou BiPAP (IPAP 10-20, EPAP 5-10). Indicações fortes: EAP, DPOC exacerbado.' },
      { id: 'resposta_vni', type: 'decision', text: 'Melhora em 1-2h? (FR, SpO2, gasometria)' },
      { id: 'iot', type: 'action', text: 'INTUBAÇÃO OROTRAQUEAL + VM protetora', detail: 'Vt 6 mL/kg peso predito, PEEP ≥ 5, Pplatô < 30, Driving pressure < 15' },
      { id: 'sdra', type: 'decision', text: 'PaO2/FiO2 < 150 (SDRA moderada/grave)?' },
      { id: 'prona', type: 'action', text: 'Posição PRONA por ≥ 16h/dia', detail: 'PROSEVA: reduz mortalidade em 50% na SDRA grave.' },
      { id: 'monitorar', type: 'end', text: 'Monitorização contínua + Tratar causa base + Desmame ventilatório quando possível' },
    ],
    edges: [
      { from: 'start', to: 'avaliacao' }, { from: 'avaliacao', to: 'tipo' },
      { from: 'tipo', to: 'o2', label: 'Tipo I ou II' }, { from: 'o2', to: 'resposta_o2' },
      { from: 'resposta_o2', to: 'monitorar', label: 'SIM' }, { from: 'resposta_o2', to: 'cnaf', label: 'NÃO (Tipo I)' },
      { from: 'resposta_o2', to: 'vni', label: 'NÃO (Tipo II / EAP)' },
      { from: 'cnaf', to: 'resposta_vni' }, { from: 'vni', to: 'resposta_vni' },
      { from: 'resposta_vni', to: 'monitorar', label: 'SIM' }, { from: 'resposta_vni', to: 'iot', label: 'NÃO — Falha' },
      { from: 'iot', to: 'sdra' }, { from: 'sdra', to: 'prona', label: 'SIM' },
      { from: 'sdra', to: 'monitorar', label: 'NÃO' }, { from: 'prona', to: 'monitorar' },
    ],
  },
  {
    id: 'hemorragia_digestiva', name: 'Hemorragia Digestiva Alta', specialty: 'Gastroenterologia', urgency: 'emergencia',
    description: 'Manejo da hemorragia digestiva alta — estabilização e endoscopia',
    reference: 'ESGE Guidelines 2024 / ACG 2023',
    nodes: [
      { id: 'start', type: 'start', text: 'Hematêmese, melena ou instabilidade hemodinâmica' },
      { id: 'abc', type: 'action', text: 'ABC + 2 acessos calibrosos + Cristaloide + Tipagem sanguínea', detail: 'Monitorização. SNG se dúvida (aspirado em borra de café confirma HDA).' },
      { id: 'estabilidade', type: 'decision', text: 'Paciente estável? (PAS > 90, FC < 100)' },
      { id: 'ressuscitacao', type: 'action', text: 'Ressuscitação volêmica agressiva + Concentrado de hemácias (Hb alvo > 7)', detail: 'Transfusão restritiva (exceto se sangramento maciço ou cardiopata).' },
      { id: 'glasgow_blatchford', type: 'action', text: 'Escore Glasgow-Blatchford', detail: 'GBS 0: pode ter alta com EDA ambulatorial. GBS ≥ 1: internação.' },
      { id: 'ibp', type: 'action', text: 'IBP IV em dose alta: Omeprazol 80 mg bolus + 8 mg/h infusão contínua', detail: 'Iniciar antes da EDA. Eritromicina 250 mg IV 30 min antes da EDA (procinético — melhora visualização).' },
      { id: 'varizes', type: 'decision', text: 'Suspeita de varizes esofágicas (hepatopata)?' },
      { id: 'terlipressina', type: 'action', text: 'Terlipressina 2 mg IV 4/4h + Ceftriaxona 1g/dia + EDA em < 12h', detail: 'Octreotida como alternativa. ATB profilático obrigatório em cirrótico.' },
      { id: 'eda', type: 'action', text: 'EDA em < 24h (< 12h se alto risco)', detail: 'Terapia endoscópica: injeção de adrenalina + clipe/eletrocoagulação (úlcera) ou ligadura elástica (varizes).' },
      { id: 'controle', type: 'decision', text: 'Sangramento controlado?' },
      { id: 'sucesso', type: 'end', text: 'IBP VO por 8 semanas + Erradicar H. pylori + Suspender AINE/AAS se possível + Seguimento' },
      { id: 'resangramento', type: 'action', text: 'Segunda EDA ou Angiografia com embolização ou Cirurgia', detail: 'TIPS se varizes refratárias.' },
    ],
    edges: [
      { from: 'start', to: 'abc' }, { from: 'abc', to: 'estabilidade' },
      { from: 'estabilidade', to: 'glasgow_blatchford', label: 'SIM' }, { from: 'estabilidade', to: 'ressuscitacao', label: 'NÃO' },
      { from: 'ressuscitacao', to: 'glasgow_blatchford' }, { from: 'glasgow_blatchford', to: 'ibp' },
      { from: 'ibp', to: 'varizes' }, { from: 'varizes', to: 'terlipressina', label: 'SIM' },
      { from: 'varizes', to: 'eda', label: 'NÃO' }, { from: 'terlipressina', to: 'eda' },
      { from: 'eda', to: 'controle' }, { from: 'controle', to: 'sucesso', label: 'SIM' },
      { from: 'controle', to: 'resangramento', label: 'NÃO' }, { from: 'resangramento', to: 'sucesso' },
    ],
  },
  {
    id: 'cetoacidose', name: 'Cetoacidose Diabética (CAD)', specialty: 'Endocrinologia', urgency: 'emergencia',
    description: 'Protocolo completo de manejo da CAD — hidratação, insulina e reposição de potássio',
    reference: 'ADA 2024 / SBD 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Glicemia > 250 + pH < 7,3 + Bicarbonato < 18 + Cetonemia/Cetonúria' },
      { id: 'classificar', type: 'action', text: 'Classificar gravidade: Leve (pH 7,25-7,3), Moderada (7,0-7,24), Grave (< 7,0)', detail: 'Colher: gasometria, eletrólitos, ureia, creatinina, hemograma, cetonemia, ECG.' },
      { id: 'hidratacao', type: 'action', text: 'SF 0,9% 1-1,5 L na 1ª hora', detail: 'Depois: 250-500 mL/h. Se Na+ corrigido > 135: trocar para SF 0,45%.' },
      { id: 'potassio', type: 'decision', text: 'K+ sérico?' },
      { id: 'k_baixo', type: 'alert', text: 'K+ < 3,3: REPOR K+ ANTES da insulina (20-40 mEq/h)', detail: 'NÃO iniciar insulina com K+ < 3,3 (risco de arritmia fatal).' },
      { id: 'k_normal', type: 'action', text: 'K+ 3,3-5,3: Iniciar insulina + KCl 20-30 mEq/L de soro', detail: 'Manter K+ entre 4-5 mEq/L.' },
      { id: 'k_alto', type: 'action', text: 'K+ > 5,3: Iniciar insulina SEM reposição de K+', detail: 'Monitorar K+ a cada 2h. ECG contínuo.' },
      { id: 'insulina', type: 'action', text: 'Insulina Regular 0,1 UI/kg/h IV contínua', detail: 'Alternativa: 0,14 UI/kg/h sem bolus. Meta: queda de glicemia 50-70 mg/dL/h.' },
      { id: 'glicemia_250', type: 'decision', text: 'Glicemia < 250 mg/dL?' },
      { id: 'sg5', type: 'action', text: 'Adicionar SG 5% + Reduzir insulina para 0,02-0,05 UI/kg/h', detail: 'Manter glicemia 150-200 até resolução da CAD.' },
      { id: 'resolucao', type: 'decision', text: 'CAD resolvida? (pH > 7,3, BIC > 18, AG < 12, cetonemia normal)' },
      { id: 'transicao', type: 'end', text: 'Transição para insulina SC: aplicar SC 1-2h ANTES de desligar IV. Alimentação + Investigar fator precipitante.' },
    ],
    edges: [
      { from: 'start', to: 'classificar' }, { from: 'classificar', to: 'hidratacao' },
      { from: 'hidratacao', to: 'potassio' }, { from: 'potassio', to: 'k_baixo', label: 'K+ < 3,3' },
      { from: 'potassio', to: 'k_normal', label: 'K+ 3,3-5,3' }, { from: 'potassio', to: 'k_alto', label: 'K+ > 5,3' },
      { from: 'k_baixo', to: 'insulina' }, { from: 'k_normal', to: 'insulina' }, { from: 'k_alto', to: 'insulina' },
      { from: 'insulina', to: 'glicemia_250' }, { from: 'glicemia_250', to: 'sg5', label: 'SIM' },
      { from: 'glicemia_250', to: 'resolucao', label: 'NÃO (continuar)' },
      { from: 'sg5', to: 'resolucao' }, { from: 'resolucao', to: 'transicao', label: 'SIM' },
      { from: 'resolucao', to: 'insulina', label: 'NÃO (continuar protocolo)' },
    ],
  },
  {
    id: 'tev', name: 'Tromboembolismo Venoso (TVP/TEP)', specialty: 'Pneumologia/Emergência', urgency: 'urgencia',
    description: 'Diagnóstico e tratamento do tromboembolismo venoso — TVP e TEP',
    reference: 'ESC 2024 / CHEST Guidelines 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Suspeita de TEP (dispneia, dor torácica pleurítica, taquicardia) ou TVP (edema unilateral de MMII)' },
      { id: 'estabilidade_tep', type: 'decision', text: 'TEP com instabilidade hemodinâmica? (PAS < 90)' },
      { id: 'tep_macico', type: 'alert', text: 'TEP MACIÇO → Trombólise sistêmica IMEDIATA (Alteplase 100 mg IV em 2h)', detail: 'Se contraindicação: trombectomia cirúrgica ou por cateter.' },
      { id: 'probabilidade', type: 'action', text: 'Escore de Wells (TEP ou TVP)', detail: 'TEP: Wells ≤ 4 = baixa probabilidade. > 4 = alta. TVP: Wells ≥ 2 = provável.' },
      { id: 'ddimero', type: 'decision', text: 'D-dímero (se probabilidade baixa/intermediária)' },
      { id: 'negativo', type: 'end', text: 'D-dímero negativo → TEP/TVP EXCLUÍDO (VPN > 99%)' },
      { id: 'imagem', type: 'action', text: 'Angio-TC de tórax (TEP) ou USG Doppler de MMII (TVP)', detail: 'Angio-TC: sensibilidade > 95% para TEP. USG: sensibilidade > 95% para TVP proximal.' },
      { id: 'confirmado', type: 'decision', text: 'Diagnóstico confirmado?' },
      { id: 'anticoagulacao', type: 'action', text: 'Anticoagulação: DOAC (Rivaroxabana 15mg 12/12h 21d → 20mg/dia) ou HBPM + Varfarina', detail: 'Duração: 3 meses (provocado) ou indefinido (não provocado/recorrente). Câncer: HBPM ou Edoxabana.' },
      { id: 'risco_tep', type: 'decision', text: 'TEP de risco intermediário-alto? (PESI III-IV + disfunção VD)' },
      { id: 'uti', type: 'action', text: 'UTI + Anticoagulação + Monitorização + Considerar trombólise se deterioração', detail: 'Ecocardiograma + Troponina + BNP para estratificação.' },
      { id: 'seguimento', type: 'end', text: 'Seguimento: avaliar síndrome pós-trombótica, hipertensão pulmonar tromboembólica crônica' },
    ],
    edges: [
      { from: 'start', to: 'estabilidade_tep' },
      { from: 'estabilidade_tep', to: 'tep_macico', label: 'SIM — Instável' },
      { from: 'estabilidade_tep', to: 'probabilidade', label: 'NÃO — Estável' },
      { from: 'probabilidade', to: 'ddimero', label: 'Baixa/Intermediária' },
      { from: 'probabilidade', to: 'imagem', label: 'Alta probabilidade' },
      { from: 'ddimero', to: 'negativo', label: 'Negativo' }, { from: 'ddimero', to: 'imagem', label: 'Positivo' },
      { from: 'imagem', to: 'confirmado' }, { from: 'confirmado', to: 'anticoagulacao', label: 'SIM' },
      { from: 'confirmado', to: 'negativo', label: 'NÃO' }, { from: 'anticoagulacao', to: 'risco_tep' },
      { from: 'risco_tep', to: 'uti', label: 'SIM' }, { from: 'risco_tep', to: 'seguimento', label: 'NÃO' },
      { from: 'uti', to: 'seguimento' }, { from: 'tep_macico', to: 'seguimento' },
    ],
  },
  {
    id: 'choque', name: 'Abordagem do Choque', specialty: 'Emergência/UTI', urgency: 'emergencia',
    description: 'Classificação e manejo inicial dos 4 tipos de choque',
    reference: 'SSC 2024 / ATLS 10ª ed.',
    nodes: [
      { id: 'start', type: 'start', text: 'Hipotensão (PAS < 90 ou PAM < 65) + Sinais de hipoperfusão' },
      { id: 'abc', type: 'action', text: 'ABC + 2 acessos calibrosos + Monitorização + Lactato + Gasometria', detail: 'Sinais de hipoperfusão: taquicardia, oligúria, rebaixamento, livedo, lactato > 2' },
      { id: 'tipo', type: 'decision', text: 'Classificação do choque (USG point-of-care + exame físico)' },
      { id: 'hipovolemico', type: 'action', text: 'HIPOVOLÊMICO: Cristaloide 30 mL/kg + Identificar fonte de sangramento', detail: 'Hemorrágico: transfusão maciça (protocolo 1:1:1). Não-hemorrágico: desidratação, queimaduras.' },
      { id: 'distributivo', type: 'action', text: 'DISTRIBUTIVO (Séptico): Cristaloide 30 mL/kg + ATB em 1h + Noradrenalina se PAM < 65', detail: 'Séptico: ATB empírico + culturas antes. Anafilático: Adrenalina 0,3-0,5 mg IM.' },
      { id: 'cardiogenico', type: 'action', text: 'CARDIOGÊNICO: Dobutamina + Noradrenalina se PAS < 90 + Tratar causa', detail: 'IAM: ICP urgente. IC aguda: diurético + vasodilatador. NÃO dar volume em excesso.' },
      { id: 'obstrutivo', type: 'action', text: 'OBSTRUTIVO: Tratar causa IMEDIATA', detail: 'Tamponamento: pericardiocentese. Pneumotórax hipertensivo: descompressão com agulha → drenagem. TEP maciço: trombólise.' },
      { id: 'resposta', type: 'decision', text: 'Resposta ao tratamento inicial? (PAM > 65, lactato diminuindo)' },
      { id: 'uti_choque', type: 'end', text: 'UTI: monitorização invasiva + vasopressores + suporte de órgãos + tratar causa base' },
    ],
    edges: [
      { from: 'start', to: 'abc' }, { from: 'abc', to: 'tipo' },
      { from: 'tipo', to: 'hipovolemico', label: 'Hipovolêmico' },
      { from: 'tipo', to: 'distributivo', label: 'Distributivo' },
      { from: 'tipo', to: 'cardiogenico', label: 'Cardiogênico' },
      { from: 'tipo', to: 'obstrutivo', label: 'Obstrutivo' },
      { from: 'hipovolemico', to: 'resposta' }, { from: 'distributivo', to: 'resposta' },
      { from: 'cardiogenico', to: 'resposta' }, { from: 'obstrutivo', to: 'resposta' },
      { from: 'resposta', to: 'uti_choque' },
    ],
  },
  {
    id: 'crise_asma', name: 'Crise de Asma — Exacerbação Aguda', specialty: 'Pneumologia', urgency: 'emergencia',
    description: 'Manejo da exacerbação aguda de asma no pronto-socorro',
    reference: 'GINA 2024 / SBPT 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Dispneia + Sibilância + Uso de musculatura acessória' },
      { id: 'avaliar', type: 'action', text: 'Avaliar gravidade: FR, FC, SpO2, fala, consciência, PFE (se possível)', detail: 'Leve: fala frases, SpO2 > 92%. Moderada: fala palavras, SpO2 90-92%. Grave: não fala, SpO2 < 90%.' },
      { id: 'gravidade', type: 'decision', text: 'Gravidade da crise?' },
      { id: 'leve_mod', type: 'action', text: 'Salbutamol 4-8 jatos (com espaçador) a cada 20 min por 1h + Prednisolona 40-50 mg VO', detail: 'Ipratrópio 4-8 jatos se moderada. O2 para SpO2 93-95%.' },
      { id: 'grave', type: 'action', text: 'Salbutamol nebulização contínua + Ipratrópio + Corticoide IV + O2 alto fluxo + Sulfato de Mg 2g IV em 20 min', detail: 'Considerar adrenalina IM se anafilaxia associada.' },
      { id: 'resposta_1h', type: 'decision', text: 'Resposta em 1h? (PFE > 60%, SpO2 > 94%, melhora clínica)' },
      { id: 'alta', type: 'end', text: 'Alta: Corticoide VO 5-7 dias + CI/LABA + Plano de ação + Retorno em 2-7 dias' },
      { id: 'continuar', type: 'action', text: 'Continuar tratamento intensivo + Internar', detail: 'Se piora: IOT + VM (cuidado com hiperinsuflação dinâmica).' },
      { id: 'iot_asma', type: 'alert', text: 'IOT se: rebaixamento, fadiga respiratória, PCR iminente', detail: 'VM na asma: FR baixa, Ti curto, PEEP baixa, tolerar hipercapnia permissiva.' },
    ],
    edges: [
      { from: 'start', to: 'avaliar' }, { from: 'avaliar', to: 'gravidade' },
      { from: 'gravidade', to: 'leve_mod', label: 'Leve/Moderada' }, { from: 'gravidade', to: 'grave', label: 'Grave' },
      { from: 'leve_mod', to: 'resposta_1h' }, { from: 'grave', to: 'resposta_1h' },
      { from: 'resposta_1h', to: 'alta', label: 'SIM — Boa resposta' },
      { from: 'resposta_1h', to: 'continuar', label: 'NÃO — Sem melhora' },
      { from: 'continuar', to: 'iot_asma' },
    ],
  },
  {
    id: 'ira', name: 'Injúria Renal Aguda (IRA)', specialty: 'Nefrologia', urgency: 'urgencia',
    description: 'Diagnóstico e manejo da IRA conforme critérios KDIGO',
    reference: 'KDIGO 2024 / SBN 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Elevação de creatinina ≥ 0,3 mg/dL em 48h OU ≥ 1,5x basal em 7 dias OU débito urinário < 0,5 mL/kg/h por 6h' },
      { id: 'classificar', type: 'action', text: 'Classificar KDIGO: Estágio 1 (Cr 1,5-1,9x), Estágio 2 (Cr 2-2,9x), Estágio 3 (Cr ≥ 3x ou Cr ≥ 4 ou diálise)', detail: 'Colher: ureia, creatinina, eletrólitos, gasometria, EAS, Na urinário, FeNa.' },
      { id: 'tipo', type: 'decision', text: 'Tipo de IRA? (Pré-renal, Renal intrínseca, Pós-renal)' },
      { id: 'pre_renal', type: 'action', text: 'PRÉ-RENAL (FeNa < 1%): Ressuscitação volêmica + Suspender nefrotóxicos + Otimizar hemodinâmica', detail: 'Causas: desidratação, sangramento, IC, sepse. Responde a volume.' },
      { id: 'renal', type: 'action', text: 'RENAL INTRÍNSECA (FeNa > 2%): Tratar causa específica + Suporte', detail: 'NTA (mais comum): suspender nefrotóxicos, manter euvolemia. Nefrite intersticial: suspender droga causadora ± corticoide. Glomerulonefrite: biópsia + imunossupressão.' },
      { id: 'pos_renal', type: 'action', text: 'PÓS-RENAL: USG (hidronefrose) → Desobstrução URGENTE', detail: 'Sondagem vesical (se retenção). Nefrostomia (se obstrução ureteral bilateral). Urologia.' },
      { id: 'indicacao_dialise', type: 'decision', text: 'Indicação de diálise de urgência? (AEIOU)' },
      { id: 'dialise', type: 'alert', text: 'DIÁLISE URGENTE: Acidose refratária, Eletrólitos (K > 6,5 refratário), Intoxicação, Overload (hipervolemia refratária), Uremia sintomática', detail: 'Hemodiálise ou CRRT (instabilidade hemodinâmica).' },
      { id: 'suporte', type: 'end', text: 'Suporte: euvolemia, suspender nefrotóxicos, ajustar doses de medicamentos, monitorar eletrólitos, nutrição adequada' },
    ],
    edges: [
      { from: 'start', to: 'classificar' }, { from: 'classificar', to: 'tipo' },
      { from: 'tipo', to: 'pre_renal', label: 'Pré-renal' }, { from: 'tipo', to: 'renal', label: 'Renal' },
      { from: 'tipo', to: 'pos_renal', label: 'Pós-renal' },
      { from: 'pre_renal', to: 'indicacao_dialise' }, { from: 'renal', to: 'indicacao_dialise' },
      { from: 'pos_renal', to: 'indicacao_dialise' },
      { from: 'indicacao_dialise', to: 'dialise', label: 'SIM — AEIOU' },
      { from: 'indicacao_dialise', to: 'suporte', label: 'NÃO' }, { from: 'dialise', to: 'suporte' },
    ],
  },
  {
    id: 'meningite', name: 'Meningite Bacteriana Aguda', specialty: 'Infectologia', urgency: 'emergencia',
    description: 'Diagnóstico e tratamento empírico da meningite bacteriana — não atrasar antibiótico',
    reference: 'IDSA 2024 / SBI 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Febre + Cefaleia + Rigidez de nuca + Alteração de consciência' },
      { id: 'hemocultura', type: 'action', text: 'Hemoculturas (2 pares) + Dexametasona 0,15 mg/kg IV + ATB EMPÍRICO IMEDIATO', detail: 'NÃO atrasar ATB para fazer TC ou punção lombar!' },
      { id: 'atb', type: 'action', text: 'ATB empírico: Ceftriaxona 2g IV 12/12h + Vancomicina 15-20 mg/kg IV 8/8h', detail: '> 50 anos ou imunossuprimido: adicionar Ampicilina 2g IV 4/4h (Listeria). Neonatos: Ampicilina + Cefotaxima.' },
      { id: 'tc_antes', type: 'decision', text: 'TC antes da PL? (imunossuprimido, convulsão, papiledema, déficit focal, Glasgow < 12)' },
      { id: 'tc', type: 'action', text: 'TC de crânio SEM contraste', detail: 'Se efeito de massa: NÃO fazer PL. Manter ATB empírico.' },
      { id: 'pl', type: 'action', text: 'Punção lombar: celularidade, bioquímica, Gram, cultura, látex', detail: 'Meningite bacteriana: PMN > 1000, proteína > 100, glicose < 40, Gram positivo em 60-90%.' },
      { id: 'resultado', type: 'decision', text: 'Resultado do LCR?' },
      { id: 'bacteriana', type: 'action', text: 'Meningite BACTERIANA confirmada → Ajustar ATB conforme cultura', detail: 'Pneumococo: Ceftriaxona 14 dias. Meningococo: Ceftriaxona 7 dias. Listeria: Ampicilina 21 dias.' },
      { id: 'viral', type: 'end', text: 'Meningite VIRAL: suporte + analgesia. Se HSV: Aciclovir 10 mg/kg IV 8/8h por 14-21 dias.' },
      { id: 'seguimento', type: 'end', text: 'Seguimento: audiometria (surdez), avaliação neurológica, profilaxia de contatos (meningococo: Rifampicina ou Ceftriaxona)' },
    ],
    edges: [
      { from: 'start', to: 'hemocultura' }, { from: 'hemocultura', to: 'atb' },
      { from: 'atb', to: 'tc_antes' }, { from: 'tc_antes', to: 'tc', label: 'SIM' },
      { from: 'tc_antes', to: 'pl', label: 'NÃO' }, { from: 'tc', to: 'pl' },
      { from: 'pl', to: 'resultado' }, { from: 'resultado', to: 'bacteriana', label: 'Bacteriana' },
      { from: 'resultado', to: 'viral', label: 'Viral' }, { from: 'bacteriana', to: 'seguimento' },
    ],
  },
  {
    id: 'pcr_adulto', name: 'Parada Cardiorrespiratória (PCR) — ACLS Adulto', specialty: 'Emergência', urgency: 'emergencia',
    description: 'Algoritmo ACLS completo para PCR em adultos',
    reference: 'AHA ACLS 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Paciente irresponsivo + Sem respiração ou gasping + Sem pulso' },
      { id: 'rcp', type: 'alert', text: 'INICIAR RCP: 30:2 (compressões:ventilações). Compressões: 100-120/min, 5-6 cm, retorno completo.', detail: 'Chamar ajuda. Desfibrilador. Acesso venoso. Monitorização.' },
      { id: 'ritmo', type: 'decision', text: 'Ritmo chocável? (FV/TVSP)' },
      { id: 'choque', type: 'action', text: 'CHOQUE: Bifásico 200J → RCP 2 min → Checar ritmo', detail: '2º choque: mesma energia ou escalonar. Adrenalina 1 mg IV após 2º choque.' },
      { id: 'adrenalina_fv', type: 'action', text: 'Adrenalina 1 mg IV a cada 3-5 min + Amiodarona 300 mg IV (1ª dose) → 150 mg (2ª dose)', detail: 'Considerar causas reversíveis (5H e 5T).' },
      { id: 'nao_chocavel', type: 'action', text: 'Assistolia/AESP: RCP 2 min + Adrenalina 1 mg IV IMEDIATA + a cada 3-5 min', detail: 'NÃO dar amiodarona. Tratar causas reversíveis (5H e 5T).' },
      { id: 'causas', type: 'action', text: '5H: Hipovolemia, Hipóxia, H+ (acidose), Hipo/Hipercalemia, Hipotermia. 5T: Tensão (pneumotórax), Tamponamento, Toxinas, TEP, Trombose coronariana.', detail: 'Tratar a causa é a chave para ROSC.' },
      { id: 'rosc', type: 'decision', text: 'Retorno da circulação espontânea (ROSC)?' },
      { id: 'pos_pcr', type: 'end', text: 'Pós-PCR: UTI + Hipotermia terapêutica 32-36°C por 24h + Cateterismo se IAM + Neuroprognóstico em 72h' },
      { id: 'continuar', type: 'action', text: 'Continuar RCP + Reavaliar ritmo a cada 2 min + Tratar causas reversíveis', detail: 'Considerar cessar esforços se assistolia refratária > 20 min sem causa tratável.' },
    ],
    edges: [
      { from: 'start', to: 'rcp' }, { from: 'rcp', to: 'ritmo' },
      { from: 'ritmo', to: 'choque', label: 'SIM (FV/TVSP)' }, { from: 'ritmo', to: 'nao_chocavel', label: 'NÃO (Assistolia/AESP)' },
      { from: 'choque', to: 'adrenalina_fv' }, { from: 'adrenalina_fv', to: 'causas' },
      { from: 'nao_chocavel', to: 'causas' }, { from: 'causas', to: 'rosc' },
      { from: 'rosc', to: 'pos_pcr', label: 'SIM — ROSC' }, { from: 'rosc', to: 'continuar', label: 'NÃO' },
      { from: 'continuar', to: 'ritmo' },
    ],
  },
  {
    id: 'eclampsia', name: 'Pré-eclâmpsia Grave / Eclâmpsia', specialty: 'Obstetrícia', urgency: 'emergencia',
    description: 'Manejo da pré-eclâmpsia grave e eclâmpsia — sulfato de magnésio e resolução da gestação',
    reference: 'FEBRASGO 2024 / ACOG 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Gestante com PA ≥ 160/110 + Proteinúria + Sinais de gravidade' },
      { id: 'sinais', type: 'action', text: 'Sinais de gravidade: cefaleia intensa, escotomas, epigastralgia, plaquetas < 100.000, Cr > 1,1, TGO/TGP > 2x, EAP', detail: 'Se convulsão: ECLÂMPSIA. Se hemólise + enzimas hepáticas elevadas + plaquetas baixas: HELLP.' },
      { id: 'mgso4', type: 'alert', text: 'SULFATO DE MAGNÉSIO (Zuspan): 4g IV em 20 min (ataque) + 1-2 g/h IV contínuo (manutenção)', detail: 'Monitorar: reflexo patelar (presente), FR > 16, diurese > 25 mL/h. Antídoto: Gluconato de cálcio 1g IV.' },
      { id: 'anti_hipertensivo', type: 'action', text: 'Anti-hipertensivo: Hidralazina 5 mg IV a cada 20 min OU Nifedipino 10 mg VO a cada 30 min', detail: 'Meta: PA 140-150/90-100. NÃO reduzir PA abruptamente (hipoperfusão placentária).' },
      { id: 'ig', type: 'decision', text: 'Idade gestacional?' },
      { id: 'termo', type: 'action', text: '≥ 34 semanas: RESOLUÇÃO DA GESTAÇÃO (parto)', detail: 'Via de parto conforme condições obstétricas. Indução ou cesárea.' },
      { id: 'prematuro', type: 'action', text: '< 34 semanas: Corticoide (Betametasona 12 mg IM 2 doses) + Avaliar estabilização', detail: 'Se condição materna/fetal instável: parto independente da IG. Se estável: manter até 34 sem com vigilância intensiva.' },
      { id: 'pos_parto', type: 'end', text: 'Pós-parto: manter MgSO4 por 24h + Monitorar PA + Anti-hipertensivo se PA > 150/100 + Seguimento' },
    ],
    edges: [
      { from: 'start', to: 'sinais' }, { from: 'sinais', to: 'mgso4' },
      { from: 'mgso4', to: 'anti_hipertensivo' }, { from: 'anti_hipertensivo', to: 'ig' },
      { from: 'ig', to: 'termo', label: '≥ 34 semanas' }, { from: 'ig', to: 'prematuro', label: '< 34 semanas' },
      { from: 'termo', to: 'pos_parto' }, { from: 'prematuro', to: 'pos_parto' },
    ],
  },
  {
    id: 'hipoglicemia', name: 'Hipoglicemia — Manejo Agudo', specialty: 'Endocrinologia/Emergência', urgency: 'urgencia',
    description: 'Protocolo de manejo da hipoglicemia em diabéticos e não-diabéticos',
    reference: 'ADA 2024 / SBD 2024',
    nodes: [
      { id: 'start', type: 'start', text: 'Glicemia < 70 mg/dL (ou < 54 = hipoglicemia clinicamente significativa)' },
      { id: 'sintomas', type: 'action', text: 'Tríade de Whipple: glicemia baixa + sintomas + resolução com glicose', detail: 'Adrenérgicos: tremor, sudorese, taquicardia, fome. Neuroglicopênicos: confusão, convulsão, coma.' },
      { id: 'consciencia', type: 'decision', text: 'Paciente consciente e capaz de deglutir?' },
      { id: 'oral', type: 'action', text: '15-20g de carboidrato de absorção rápida VO', detail: '3-4 sachês de açúcar, 150 mL de suco, 1 colher de sopa de mel. Repetir em 15 min se glicemia < 70.' },
      { id: 'iv', type: 'action', text: 'Glicose 50% — 40-60 mL IV (20-30g de glicose)', detail: 'Se sem acesso IV: Glucagon 1 mg IM/SC. Posição lateral de segurança.' },
      { id: 'resposta', type: 'decision', text: 'Glicemia > 70 em 15 min?' },
      { id: 'repetir', type: 'action', text: 'Repetir tratamento + Investigar causa', detail: 'Se refratária: infusão contínua de SG 10%. Considerar insuficiência adrenal, insulinoma, sepse.' },
      { id: 'manutencao', type: 'end', text: 'Lanche com carboidrato complexo + proteína. Ajustar medicação (reduzir insulina/sulfonilureia). Educação do paciente.' },
    ],
    edges: [
      { from: 'start', to: 'sintomas' }, { from: 'sintomas', to: 'consciencia' },
      { from: 'consciencia', to: 'oral', label: 'SIM — Consciente' },
      { from: 'consciencia', to: 'iv', label: 'NÃO — Inconsciente' },
      { from: 'oral', to: 'resposta' }, { from: 'iv', to: 'resposta' },
      { from: 'resposta', to: 'manutencao', label: 'SIM' }, { from: 'resposta', to: 'repetir', label: 'NÃO' },
      { from: 'repetir', to: 'resposta' },
    ],
  },
];
